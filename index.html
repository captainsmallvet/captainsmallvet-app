<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmallVet AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body::-webkit-scrollbar { display: none; }
        .chat-container { height: calc(100vh - 180px); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col font-sans">

    <header class="bg-blue-600 text-white p-4 shadow-md flex justify-between items-center sticky top-0 z-10">
        <div>
            <h1 class="font-bold text-lg">SmallVet AI</h1>
            <p id="model-display" class="text-xs opacity-80">Connecting...</p>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleMenu()" class="bg-blue-700 p-2 rounded-lg text-sm">MENU</button>
            <button onclick="clearKey()" class="bg-red-500 p-2 rounded-lg text-sm">KEY</button>
        </div>
    </header>

    <div id="app-menu" class="hidden bg-white border-b p-4 grid grid-cols-3 gap-3 shadow-inner">
        <button class="bg-gray-100 p-3 rounded-xl text-xs font-bold text-blue-600 border border-blue-200">AI Chat</button>
        <button onclick="alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤')" class="bg-gray-50 p-3 rounded-xl text-xs text-gray-400 border">Vet Diagnosis</button>
        <button onclick="alert('‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏î‡∏™‡∏¢‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤')" class="bg-gray-50 p-3 rounded-xl text-xs text-gray-400 border">Drug Calc</button>
    </div>

    <div id="setup-section" class="p-6 mt-10 hidden">
        <div class="bg-white p-6 rounded-3xl shadow-xl text-center">
            <div class="text-5xl mb-4">ü©∫</div>
            <h2 class="text-xl font-bold mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô SmallVet</h2>
            <p class="text-gray-500 text-sm mb-6">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key ‡∏à‡∏≤‡∏Å Google AI Studio</p>
            <input type="password" id="api-key" placeholder="AIzaSy..." 
                class="w-full p-4 border rounded-2xl mb-4 focus:ring-2 focus:ring-blue-500 outline-none bg-gray-50">
            <button onclick="saveKey()" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-bold shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏´‡∏±‡∏™</button>
        </div>
    </div>

    <main id="chat-section" class="flex-1 flex flex-col hidden">
        <div id="chat-log" class="flex-1 p-4 overflow-y-auto space-y-4 chat-container bg-gray-50">
            <div class="bg-blue-50 text-blue-600 text-center p-3 rounded-2xl text-xs">
                ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏´‡∏°‡∏≠! ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÄ‡∏Ñ‡∏™‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?
            </div>
        </div>

        <div class="p-4 bg-white border-t pb-8">
            <div class="flex gap-2 max-w-4xl mx-auto">
                <input type="text" id="user-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." 
                    class="flex-1 p-4 bg-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-400 transition-all">
                <button onclick="sendToAI()" id="send-btn" class="bg-blue-600 text-white px-8 rounded-2xl font-bold shadow-md active:scale-95 transition-transform">‡∏™‡πà‡∏á</button>
            </div>
        </div>
    </main>

    <script>
        const modelsToTry = ["gemini-3-flash-preview", "gemini-2.5-flash", "gemini-1.5-flash"];
        let currentActiveModel = "Gemini Assistant";

        window.onload = () => {
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                document.getElementById('chat-section').classList.remove('hidden');
                document.getElementById('model-display').innerText = "Ready to assist";
            } else {
                document.getElementById('setup-section').classList.remove('hidden');
            }
        };

        function toggleMenu() {
            const menu = document.getElementById('app-menu');
            menu.classList.toggle('hidden');
        }

        function saveKey() {
            const key = document.getElementById('api-key').value.trim();
            if (key.startsWith('AIza')) {
                localStorage.setItem('gemini_api_key', key);
                location.reload();
            } else { alert("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"); }
        }

        function clearKey() {
            if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API Key ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                localStorage.removeItem('gemini_api_key');
                location.reload();
            }
        }

        // ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô sendToAI ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏£‡∏±‡∏ö
async function sendToAI() {
    const inputField = document.getElementById('user-input');
    const prompt = inputField.value.trim();
    const apiKey = localStorage.getItem('gemini_api_key');
    const chatLog = document.getElementById('chat-log');
    const btn = document.getElementById('send-btn');
    const modelLabel = document.getElementById('model-display'); // ‡∏ï‡∏±‡∏ß‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô

    if (!prompt) return;

    chatLog.innerHTML += `<div class="flex justify-end"><div class="bg-blue-600 text-white p-3 rounded-2xl rounded-tr-none max-w-[85%] shadow-sm">${prompt}</div></div>`;
    inputField.value = '';
    btn.disabled = true;
    btn.innerHTML = "‚è≥";

    let success = false;
    for (const modelName of modelsToTry) {
        if (success) break;
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await response.json();
            
            if (response.ok) {
                const aiText = data.candidates[0].content.parts[0].text;
                chatLog.innerHTML += `<div class="flex justify-start"><div class="bg-white border text-gray-800 p-3 rounded-2xl rounded-tl-none max-w-[85%] shadow-sm">${aiText}</div></div>`;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
                modelLabel.innerText = "Active Model: " + modelName.toUpperCase();
                modelLabel.classList.add('text-yellow-300'); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÉ‡∏´‡πâ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏á‡πà‡∏≤‡∏¢
                
                success = true;
            }
        } catch (e) {
            console.log(modelName + " failed, trying next...");
        }
    }

    if (!success) {
        chatLog.innerHTML += `<div class="text-red-500 text-center text-xs">Error: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Model ‡πÑ‡∏î‡πâ</div>`;
    }

    btn.disabled = false;
    btn.innerHTML = "‡∏™‡πà‡∏á";
    chatLog.scrollTop = chatLog.scrollHeight;
}
    </script>
</body>
</html>